
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Adding Composer to a legacy code project - Pedro Nofuentes</title>
  <meta name="author" content="Pedro Nofuentes">

  
  <meta name="description" content="In a project of legacy code that I&rsquo;m working with we have the needing to use some external libraries in order to do some tasks. Also, we &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pedro.nofuent.es/blog/2014/03/20/adding-composer-to-a-legacy-code-project">
  <link href="/favicon.png" rel="icon">
  <link href="http://fonts.googleapis.com/css?family=Vollkorn:400italic,700italic,400,700|Oswald" rel="stylesheet" type="text/css">

  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Pedro Nofuentes" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-27557011-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav class="top-bar" data-topbar>
  <ul class="title-area">
    <li class="name"><h1 class="site-title"><a href="/">Pedro Nofuentes</a></h1></li>
    <li class="toggle-topbar menu-icon"><a href="#">&nbsp;</a></li>
  </ul>
  <section class="top-bar-section">
    <ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

  </section>
</nav>

  <div class="row">
    <div id="header">
      <header role="banner"><hgroup>
  <h1 class="site-title"><a href="/">Pedro Nofuentes</a></h1>
  
    <h2 class="site-subtitle">Just another blog</h2>
  
</hgroup>

</header>
      <div class="social subscription" data-subscription="rss">
  
    <a class="twitter symbol" href="https://twitter.com/pedronofuentes"><i class="fa fa-twitter"></i></a>
  
  
    <a class="github symbol" href="https://github.com/pedronofuentes"><i class="fa fa-github"></i></a>
  
  
    <a class="googleplus symbol" href="https://google.com/+PedroNofuentesAzcárate?rel=author"><i class="fa fa-google-plus"></i></a>
  
  
    <a class="linkedin symbol" href="http://linkedin.com/in/pedronofuentesazcarate"><i class="fa fa-linkedin"></i></a>
  

  <a class="rss symbol" href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS"><i class="fa fa-rss"></i></a>

  
</div>

      <nav role="navigation"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

  
</nav>
    </div>
    <div id="main">
      <div class="social subscription" data-subscription="rss">
  
    <a class="twitter symbol" href="https://twitter.com/pedronofuentes"><i class="fa fa-twitter"></i></a>
  
  
    <a class="github symbol" href="https://github.com/pedronofuentes"><i class="fa fa-github"></i></a>
  
  
    <a class="googleplus symbol" href="https://google.com/+PedroNofuentesAzcárate?rel=author"><i class="fa fa-google-plus"></i></a>
  
  
    <a class="linkedin symbol" href="http://linkedin.com/in/pedronofuentesazcarate"><i class="fa fa-linkedin"></i></a>
  

  <a class="rss symbol" href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS"><i class="fa fa-rss"></i></a>

  
</div>

      <div id="content">
        <div>
<article class="hentry" role="article">
  
  <header>
    
      <p class="meta">
        








  


<time datetime="2014-03-20T23:26:12+01:00" pubdate data-updated="true">Mar 20<span>th</span>, 2014</time>
        
      </p>
    
    
      <h1 class="entry-title">Adding Composer to a legacy code project</h1>
    
  </header>


  

    <div class="main-image"><img src="/images/posts/dude-there-is-a-lot-of-work-here.jpg"></div>


  <div class="entry-content"><p>In a project of legacy code that I&rsquo;m working with we have the needing to use some external libraries in order to do some tasks. Also, we planned to refactor the code step by step to introduce good practices, reduce coupling, code duplication, etc.</p>

<p>At this point we had to implement a cron job to send users like a newsletter. This task was the perfect opportunity to create the basic scaffold using <a href="http://symfony.com/components">Symfony components</a> as it is isolated from the rest of the web application: we consume the data, but almost all the funcionality is new. Then, the first step was to introduce <a href="https://getcomposer.org/">Composer</a> to manage the vendor libraries and autoloading.</p>

<!-- more -->


<h2>Context</h2>

<p>Before we start, some points about the project:</p>

<ul>
<li>The project doesn&rsquo;t follow any naming or structure convention. It uses classes and namespacing, but as an example the class names are lowercase and variable names are uppercase.</li>
<li>The code has an autoloading function, but the intention is to replace it with Composer&rsquo;s autoloading.</li>
<li>There are some libraries included in the folder structure.</li>
<li>There are some files with functions defined between class files.</li>
</ul>


<p>The project has this folder structure:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>.
</span><span class='line'>|____core
</span><span class='line'>|____imagenes
</span><span class='line'>|____modulos
</span><span class='line'>|____objetos
</span></code></pre></td></tr></table></div></figure>


<p>The folders containing classes are <code>core</code> and <code>modulos</code>, the other ones contain assets such images, javascript or templates.</p>

<h2>Goal</h2>

<p>The goal is to configure Composer to:</p>

<ul>
<li>Handle the autoloading of existing code.</li>
<li>Handle the autoloading of new code following <a href="http://www.php-fig.org/">PHP-FIG</a> standards.</li>
<li>Include files with functions.</li>
<li>Handle vendor libraries.</li>
</ul>


<p>Then we decided to add the known <code>vendor</code> folder and <code>src</code> for the new code.</p>

<h2>Configuring Composer</h2>

<h3>Autoloading</h3>

<p>The first step was configure autoloading. Insted the existing code naming is weird, it respects a class per file and the folder structure corresponding with the namespace, thus we can say that &ldquo;follows&rdquo; the <a href="http://www.php-fig.org/psr/psr-0/">PSR-0</a> for autoloading. For the new code we will follow the <a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a>. Then we can configure autoloading like this:</p>

<figure class='code'><figcaption><span>composer.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;autoload&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;psr-4&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Acme\\&quot;</span><span class="p">:</span> <span class="s2">&quot;src/&quot;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nt">&quot;psr-0&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;&quot;</span><span class="p">:</span> <span class="s2">&quot;./&quot;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Previous existing libraries</h3>

<p>At this point we have some existing libraries included in the code without namespace. Then we have to configure Composer to include them using the <a href="https://getcomposer.org/doc/04-schema.md#classmap"><code>classmap</code> references</a>.</p>

<p>For example we are using the <a href="http://www.tcpdf.org">TCPDF</a> library and is stored in <code>core/app/libs</code>:</p>

<figure class='code'><figcaption><span>composer.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;autoload&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;classmap&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>            <span class="s2">&quot;core/app/libs/tcpdf.php&quot;</span>
</span><span class='line'>        <span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Files with functions</h3>

<p>Finally to include individual files in the project we use the <a href="https://getcomposer.org/doc/04-schema.md#files">files autoloading</a> implemented. For example, we have <code>modulos/sistema/funciones.php</code> that we want to include automatically:</p>

<figure class='code'><figcaption><span>composer.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;autoload&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;files&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>            <span class="s2">&quot;modulos/sistema/funciones.php&quot;</span>
</span><span class='line'>        <span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Pedro Nofuentes</span></span>

      








  


<time datetime="2014-03-20T23:26:12+01:00" pubdate data-updated="true">Mar 20<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/php/'>PHP</a>, <a class='category' href='/blog/categories/composer/'>composer</a>, <a class='category' href='/blog/categories/legacy-code/'>legacy code</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://pedro.nofuent.es/blog/2014/03/20/adding-composer-to-a-legacy-code-project/" data-via="pedronofuentes" data-counturl="http://pedro.nofuent.es/blog/2014/03/20/adding-composer-to-a-legacy-code-project/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta post-navitagion clearfix">
      
        <a class="basic-alignment left" href="/blog/2013/10/11/un-vistazo-a-xdebug/" title="Previous Post: Un vistazo a Xdebug">&laquo; Un vistazo a Xdebug</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/07/01/debugging-console-with-xdebug-in-a-remote-server/" title="Next Post: Debugging console with XDebug in a remote server">Debugging console with XDebug in a remote server &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/01/debugging-console-with-xdebug-in-a-remote-server/">Debugging console with XDebug in a remote server</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/20/adding-composer-to-a-legacy-code-project/">Adding Composer to a legacy code project</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/11/un-vistazo-a-xdebug/">Un vistazo a Xdebug</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/27/it-s-alive/">It's alive!!!</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/pedronofuentes">@pedronofuentes</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pedronofuentes',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>


      </div>
    </div>
  </div>
  <div class="row">
    <footer id="footer" role="contentinfo"><p>
  Copyright &copy; 2014 - Pedro Nofuentes -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'pedronofuentes';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://pedro.nofuent.es/blog/2014/03/20/adding-composer-to-a-legacy-code-project/';
        var disqus_url = 'http://pedro.nofuent.es/blog/2014/03/20/adding-composer-to-a-legacy-code-project/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </div>

  <script src="/javascripts/libs/fastclick.js"></script>
  <script src="/javascripts/libs/foundation.min.js"></script>
  <script>
    $(document).foundation();
  </script>
</body>
</html>
